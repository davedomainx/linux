
https://docs.openstack.org/mitaka/networking-guide/misc-libvirt.html
..  libvirt creates an additional bridge, dnsmasq process, and iptables ruleset ..

The virbr0 bridge stays around even after you disable libvirtd, cobblerd and other suspect services..  aah ffs NetworkManager..

# Network stuff
virsh net-list
virsh net-destroy default
virsh net-autostart --network default --disable

# Destroy VM
virsh shutdown vm-foreman
virsh destroy vm-foreman
virsh undefine vm-foreman
rm /disk/img/X.img

# I am not sure if I need to swap the virbr0 and eth0 IPs around ..

# create a disk image in qcow2 format
qemu-img create -f qcow2 ./100g.qcow2 100G

# SELinux config for /data/img
semanage fcontext --add -t virt_image_t '/data/img(/.*)?'
semanage fcontext -l |grep virt_image_t

# see /data/img/c7.sh for VM startup stuff
# 1. note need to kickstart or install from install media onto VM as per normal

# connect to console
virsh console vm-foreman

semanage fcontext --add -t virt_image_t '/data/img(/.*)?'
semanage fcontext -l | grep virt_image_t
/var/lib/imagefactory/images(/.*)? all files system_u:object_r:virt_image_t:s0
/var/lib/libvirt/images(/.*)? all files system_u:object_r:virt_image_t:s0
/data/img(/.*)? all files system_u:object_r:virt_image_t:s0
# 4. Restore the security context. This will effectively change the context to virt_image_t:
restorecon -R -v /data/img
# Verify that the context was changed:
ls â€“aZ /data/img
drwxr-xr-x. root root system_u:object_r:virt_image_t:s0 .
dr-xr-xr-x. root root system_u:object_r:root_t:s0 ..
# 5. If you are going to export the directory /data/img as a samba or NFS share, there are SELinux
# Booleans that need to be set as well:
setsebool -P virt_use_samba 1
setsebool -P virt_use_nfs 1
